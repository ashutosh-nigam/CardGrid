var SortDirection,CardGrid;(function(n){n[n.asc=0]="asc";n[n.desc=1]="desc"})(SortDirection||(SortDirection={}));CardGrid=function(){function n(n,t){if(this._allowToSwitchView=!1,!n.hasClass("flex-grid")){alert("Please Specify flex-grid class");return}if(this.options=$.extend({url:"#",data:null,type:"GET",pagination:!0,searchBox:!0,success:null,recordsPerPage:[12],ItemsPerRow:4,template:null,cols:null,currentView:"card",sortCols:[{text:"Id",value:"Id"}],multiSelect:!0,queryParams:null,beforeSend:null,beforeGridLoad:null},t),window.localStorage.getItem("cardgrid-view")?this.options.currentView=window.localStorage.getItem("cardgrid-view"):window.localStorage.setItem("cardgrid-view",this.options.currentView),this.options.template&&this.options.cols)this._allowToSwitchView=!0;else if(this.options.template==null&&this.options.cols!=null)this.options.currentView="table",this._allowToSwitchView=!1;else if(this.options.template!=null&&this.options.cols==null)this.options.currentView="card",this._allowToSwitchView=!1;else{alert("Please Define Template for Grid");return}var i="";n.attr("id")?i=n.attr("id"):(i="cardgrid"+Math.floor(Math.random()*100+1e3).toString(),n.attr("id",i));this.cardGridId=i;this.flexRowId=i+"-flex-row";this.searchBoxId=i+"-search-textbox";this.sortbyId=i+"-sort-by";this.paginationControlId=i+"-page-selection";this.goToPageControlId=i+"-go-to-page";this.viewControlId=i+"-view";this.switchViewControlId=i+"-switchView";this.pageSizeSelect=i+"-pageSizeSelect";this.selectedDataIds=[];this.buildGrid();this.load()}return n.prototype.getOptions=function(){return this.options},n.prototype.getData=function(){return this.options.data},n.prototype.load=function(){var n=this.options,t=this;$.isFunction($.fn.select2);n.beforeSend!=null&&n.beforeSend();$.ajax({type:n.type,url:this.options.url+(this.options.queryParams!=null?"?"+$.param(this.options.queryParams):""),method:this.options.type,data:this.getRequestParams(),dataType:"json",success:function(i){n.beforeGridLoad!=null&&(i=n.beforeGridLoad(i));n.data=i;t.processData(i);n.success&&n.success!=undefined&&typeof n.success=="function"&&n.success();$(".dropdown-toggle").dropdown();n.afterGridRender&&n.afterGridRender!=undefined&&typeof n.afterGridRender=="function"&&n.afterGridRender()},error:function(n,t){n.status===500&&t=="error"&&$.error(n.responseText)}})},n.prototype.reload=function(){this.load()},n.prototype.getRequestParams=function(){var n=window.localStorage.getItem("cardgrid-stored-per-page")!=null?parseInt(window.localStorage.getItem("cardgrid-stored-per-page")):this.options.recordsPerPage[0];return this.Pagination||(this.Pagination={total:0,noOfPages:1,rows:n,page:1,searchParam:"",sord:"asc",sidx:this.options.sortCols[0].value}),this.options.searchBox&&(this.Pagination.searchParam=document.getElementById(this.searchBoxId).value),this.Pagination},n.prototype.processData=function(n){var t=this,r;if(n==null||n==undefined)alert("No Data");else{if(this.Pagination.noOfPages=parseInt(Math.ceil(parseFloat(n.total.toString())/parseFloat(this.Pagination.rows.toString())).toString()),this.Pagination.total=n.total,r=document.getElementById(t.goToPageControlId),r&&(r.value=this.Pagination.page.toString()),jQuery.isFunction($.fn.bootpag))$("#"+this.paginationControlId).unbind("page").show().bootpag({total:this.Pagination.noOfPages,page:this.Pagination.page,maxVisible:5,leaps:!0,next:"Next",prev:"Prev",first:"First",last:"Last",firstLastUse:!0}).on("page",function(n,i){t.Pagination.page=i;var r=document.getElementById(t.goToPageControlId);r.value=i.toString();t.load()});else{alert("Please download Bootpag from http://botmonster.com/jquery-bootpag/#.V--5BSh96hc");window.open("http://botmonster.com/jquery-bootpag/#.V--5BSh96hc","_blank");return}var i=t.Pagination.page,f=i-1,u=t.Pagination.rows,e=i==1?1:f*u+1,o=i==t.Pagination.noOfPages?t.Pagination.total:i*u,s="View "+e.toString()+" - "+o.toString()+" of "+t.Pagination.total.toString(),h=$("<div/>",{text:s,style:"height: 34px;padding: 6px 12px;"});$("#"+this.viewControlId).empty().append(h);this.buildCardTable(t,n.Data)}},n.prototype.buildCardTable=function(n,t){var r=document.getElementById(this.flexRowId),h,f;if(r.innerHTML="",n.options.currentView=="card")$.each(t,function(t,i){var e=n.options.template(i),u=$("<div/>",{"data-id":i.Id,id:n.cardGridId+"-data-"+i.Id}),f;switch(n.options.itemsPerRow){case 2:u.addClass("col-xs-12 col-sm-6 col-lg-6");break;case 3:u.addClass("col-xs-12 col-sm-4 col-lg-4");break;case 4:u.addClass("col-xs-12 col-sm-4 col-lg-3");break;case 6:u.addClass("col-xs-12 col-sm-3 col-lg-2");break;case 12:u.addClass("col-xs-12 col-sm-3 col-lg-1")}f=$("<div/>",{"class":"thumbnail"});$.inArray(i.Id.toString(),n.selectedDataIds)!==-1&&f.attr("selected","selected");u.unbind("click");u.on("click",function(){var i=$(this).attr("data-id"),t;$(f).attr("selected")=="selected"?($(f).removeAttr("selected"),t=n.selectedDataIds.indexOf(i),t>-1&&n.selectedDataIds.splice(t,1)):(n.options.multiSelect||($(r).find(".thumbnail").removeAttr("selected"),n.selectedDataIds.splice(0,n.selectedDataIds.length)),$(f).attr("selected","selected"),n.selectedDataIds.push(i))});f.append(e).appendTo(u);$(r).append(u)});else{var i=$("<table/>",{"class":"table table-striped table-bordered dataTable",role:"grid"}),u=$("<thead/>"),e=$("<tr/>",{role:"row"}),o=0,s=0;$.each(n.options.cols,function(n,t){t.width!=undefined&&(o+=t.width,s+=1)});h=(100-o)/(n.options.cols.length-s);$.each(n.options.cols,function(n,t){t=$.extend({sortable:!0,hidden:!1,template:null,width:h},t);var i=$("<th/>",{text:t.title,style:"width:"+t.width+"%",colspan:1,rowspan:1});t.hidden?i.attr("hidden","hidden"):i.removeAttr("hidden");t.sortable?i.addClass("sorting"):i.removeClass("sorting");e.append(i)});u.append(e);i.append(u);i.append(u);$.each(t,function(t,r){var u=$("<tr/>",{"data-id":r.Id});$.each(n.options.cols,function(n,t){var i=$("<td/>");i.append(t.template!=null?t.template(r):r[t.id]);t.hidden?i.attr("hidden","hidden"):i.removeAttr("hidden");u.append(i)});u.unbind("click");$.inArray(r.Id.toString(),n.selectedDataIds)!==-1&&u.attr("selected","selected");u.bind("click",function(){var r=u.attr("data-id"),t;u.attr("selected")=="selected"?(u.removeAttr("selected"),t=n.selectedDataIds.indexOf(r),t>-1&&n.selectedDataIds.splice(t,1)):(n.options.multiSelect||(i.find("tr").removeAttr("selected"),n.selectedDataIds.splice(0,n.selectedDataIds.length)),u.attr("selected","selected"),n.selectedDataIds.push(r))});i.append(u)});f=$("<div/>",{"class":"col-lg-12 col-md-12 col-sm-12 col-xs-12"});f.append(i);$(r).append(f)}},n.prototype.buildGrid=function(){var n=document.getElementById(this.cardGridId);$(n).append(this.createHeader()).append('<div class="clearfix" style="margin-top:20px"><\/div>').append($("<div/>",{"class":"flex-row row",id:this.flexRowId})).append('<div class="clearfix"><\/div>').append(this.createFooter())},n.prototype.createHeader=function(){var n=this,e=$("<div/>",{"class":"header"}),o=$("<div/>",{"class":"row"}),s=$("<div/>",{"class":"col-xs-12 col-lg-3 col-md-4 col-sm-12"}),h=$("<div/>",{"class":"col-xs-12 col-lg-5 col-md-4 col-sm-12",style:"text-align:center"}),c=$("<div/>",{"class":"col-xs-12 col-lg-4 col-md-4 col-sm-12"}),t,r,y;if(this.options.searchBox){var l=$("<div/>",{style:"float:left;width:100%"}),a=$("<input/>",{type:"text","class":"form-control has-feedback-left",id:this.searchBoxId}),p=$("<span/>",{"class":"fa fa-search form-control-feedback left","aria-hidden":"true"});l.append(a).append(p);l.appendTo(s);$(a).on("keypress",function(t){if(t.keyCode==13)return n.load(),!1})}if(n.options.sortCols&&n.options.sortCols.length>0){t=$("<select/>",{"class":"form-control",style:"width:70%;display:inline;",id:this.sortbyId});$.each(n.options.sortCols,function(n,i){t.append($("<option/>",{value:i.value+"-asc",text:i.text+" - Asc","data-val":i.value,"sort-direction":"asc"}));t.append($("<option/>",{value:i.value+"-desc",text:i.text+" - Desc","data-val":i.value,"sort-direction":"desc"}))});t.change(function(){n.Pagination.sidx=$("option:selected",this).attr("data-val");n.Pagination.sord=$("option:selected",this).attr("sort-direction");n.reload()});r=$("<div/>",{style:"float:left;width:60%;text-align:left;"});r.append("Sort by : ").append(t);var i=$("<div/>",{style:"float:right;width:40%"}),u=$("<button/>",{"class":"btn btn-default","data-type":"table"}).append('<i class="fa fa-table" aria-hidden="true"><\/i>'),f=$("<button/>",{"class":"btn btn-default","data-type":"card"}).append('<i class="fa fa-credit-card" aria-hidden="true"><\/i>'),v=$("<div/>",{"class":"btn-group btn-toggle"});this.options.currentView==="card"?(u.removeClass("btn-primary active"),f.addClass("btn-primary active")):(f.removeClass("btn-primary active"),u.addClass("btn-primary active"));v.append(f).append(u);this._allowToSwitchView&&(i.append("View : "),i.append(v));h.append(r).append(i);i.find(".btn-toggle").click(function(){$(this).find(".btn").toggleClass("active");$(this).find(".btn-primary").length>0&&$(this).find(".btn").toggleClass("btn-primary");$(this).find(".btn").toggleClass("btn-default");$(this).find('.btn[data-type="table"]').hasClass("active")?(n.options.currentView="table",window.localStorage.setItem("cardgrid-view","table")):(n.options.currentView="card",window.localStorage.setItem("cardgrid-view","card"));n.buildCardTable(n,n.getData().Data)})}return this.options.buttons&&this.options.buttons.length>0&&(y=this.createButtons(this.options.buttons),c.append(y)),o.append(s).append(h).append(c),e.append(o),e[0]},n.prototype.createFooter=function(){var n=this,u=$("<div/>",{"class":"footrow row",style:"padding-top: 20px;border-top: 2px solid #E6E9ED;"}),i=$("<div/>",{"class":"col-xs-12 col-lg-4 col-md-12 col-sm-12"}),f=$("<div/>",{"class":"col-xs-12 col-lg-4 col-md-12 col-sm-12"}),e=$("<div/>",{"class":"col-xs-12 col-lg-4 col-md-6 col-sm-12"}),t,o,r,s;n.options.recordsPerPage.length>1&&(t=$("<select/>",{id:n.pageSizeSelect,style:"width: 80px;display:inline","class":"form-control"}),o=window.localStorage.getItem("cardgrid-stored-per-page")?window.localStorage.getItem("cardgrid-stored-per-page"):n.options.recordsPerPage[0],$.each(n.options.recordsPerPage,function(n,i){var r=$("<option/>",{value:i,text:i});i==o&&r.attr("selected","selected");t.append(r)}),t.change(function(){n.Pagination.rows=$(this).val();n.Pagination.page=1;window.localStorage.setItem("cardgrid-stored-per-page",$(this).val());n.reload()}),i.append($("<div/>",{"class":"col-xs-6 col-lg-6 col-md-6 col-sm-6"}).append("Row Count :").append(t)));r=$("<input/>",{id:this.goToPageControlId,type:"text",style:"width: 80px;display:inline","class":"form-control"});$(r).on("keypress",function(t){if(t.keyCode==13)return this.value===""||parseInt(this.value)>n.Pagination.noOfPages?alert("Out of Range! "+n.Pagination.noOfPages+" Pages Available"):(n.Pagination.page=parseInt(this.value),n.reload()),!1});return f.append($("<div/>",{"class":"col-center",style:"text-align:center",id:this.viewControlId})),i.append($("<div/>",{"class":"col-xs-6 col-lg-6 col-md-6 col-sm-6"}).append("Go To Page :").append(r)),s=$("<div/>",{id:this.paginationControlId}),e.append($("<div/>",{"class":"flex-paginaton"}).append(s)),$(u).append(i).append(f).append(e),$(u)[0]},n.prototype.createButtons=function(n){var t=this,i=t.options,r=$("<div/>",{"class":"btn-group nav navbar-right panel_toolbox"});return $.each(n,function(n,u){var e,f,o,s;u=$.extend({id:"-btn-"+(n+1),enable:!0,hidden:!1,buttons:null,onClick:null},u);u.buttons===null?(f=$("<button/>",{text:u.text,"class":"btn btn-default",id:t.cardGridId+u.id}),u.enable?f.removeClass("disabled"):f.addClass("disabled"),u.className&&f.addClass(u.className),u.onClick&&$(f).click(function(){u.onClick(i.data)}),u.hidden?f.hide():f.show(),r.append(f)):u.buttons&&u.buttons.length>0&&(e=$("<div/>",{"class":"btn-group"}),f=$("<button/>",{text:u.text,"class":"btn btn-default",id:t.cardGridId+u.id}),u.className&&f.addClass(u.className),u.onClick&&$(f).click(function(){u.onClick(i.data)}),u.hidden?f.hide():f.show(),e.append(f),o=$("<button/>",{"data-toggle":"dropdown","class":"btn btn-default dropdown-toggle",type:"button","aria-expanded":"false"}),o.append('<span class="caret"><\/span>'),s=$("<ul/>",{"class":"dropdown-menu"}),$.each(u.buttons,function(r,f){var e,o;f=$.extend({id:"-btn-"+(n+1)+"-"+(r+1),enable:!0,hidden:!1,onClick:null},f);e=$("<a/>",{href:"#",html:f.text,id:t.cardGridId+u.id});f.onClick&&$(e).click(function(n){n.preventDefault();f.onClick(i.data)});o=$("<li/>").append(e).appendTo(s);f.hidden?o.hide():o.show()}),o.appendTo(e),s.appendTo(e),e.appendTo(r))}),$(".dropdown-toggle").dropdown(),r[0]},n.prototype.getSelectedData=function(){var n=this,t=[],i=document.getElementById(n.flexRowId),r,u;return i&&(n.options.currentView==="card"?(r=$(i).find("[selected]").parent(),$.each(r,function(i,r){$.each(n.getData().Data,function(n,i){var u=parseInt($(r).attr("data-id"));i.Id===u&&t.push(i)})})):(u=$(i).find("table").find('tr[selected="selected"]'),$.each(u,function(i,r){$.each(n.getData().Data,function(n,i){var u=parseInt($(r).attr("data-id"));i.Id===u&&t.push(i)})}))),t},n.prototype.getSelectedIds=function(){var t=this.getSelectedData(),n=[];return $.each(t,function(t,i){n.push(i.Id)}),n},n}(),function(n){n.fn.cardGrid=function(t){return new CardGrid(n(this),t)}}(jQuery);